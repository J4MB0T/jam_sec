<!DOCTYPE html>
<html lang="en">

<head><script src="/jam_sec/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=jam_sec/livereload" data-no-instant defer></script>
  <title>
  🚀 Using Terraform with vSphere: A Step-by-Step Guide · JAM_SEC
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self' http://localhost:1313 http://127.0.0.1:1313; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="JAM_SEC">
<meta name="description" content="Terraform Provisioning">
<meta name="keywords" content="blog,developer,personal,cyber,security">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="🚀 Using Terraform with vSphere: A Step-by-Step Guide">
  <meta name="twitter:description" content="Terraform Provisioning">

<meta property="og:url" content="http://localhost:1313/jam_sec/posts/terraform/">
  <meta property="og:site_name" content="JAM_SEC">
  <meta property="og:title" content="🚀 Using Terraform with vSphere: A Step-by-Step Guide">
  <meta property="og:description" content="Terraform Provisioning">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-18T18:19:49+13:00">
    <meta property="article:modified_time" content="2025-02-18T18:19:49+13:00">
    <meta property="article:tag" content="Terraform">
    <meta property="article:tag" content="VSphere">
    <meta property="article:tag" content="Infrastructure as Code">
    <meta property="article:tag" content="VM">




<link rel="canonical" href="http://localhost:1313/jam_sec/posts/terraform/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/jam_sec/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/jam_sec/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/jam_sec/">
      JAM_SEC
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/jam_sec/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/jam_sec/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/jam_sec/htb/">Hack The Box</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/jam_sec/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/jam_sec/contact/">Contact me</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/jam_sec/posts/terraform/">
              🚀 Using Terraform with vSphere: A Step-by-Step Guide
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-02-18T18:19:49&#43;13:00">
                February 18, 2025
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/jam_sec/tags/terraform/">Terraform</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/jam_sec/tags/vsphere/">VSphere</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/jam_sec/tags/infrastructure-as-code/">Infrastructure as Code</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/jam_sec/tags/vm/">VM</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h1 id="-terraform--vsphere--a-match-made-in-cloud-heaven-">
  🛠️ Terraform + vSphere = A Match Made in Cloud Heaven ☁️
  <a class="heading-link" href="#-terraform--vsphere--a-match-made-in-cloud-heaven-">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Terraform is a powerhouse for Infrastructure as Code (IaC) that lets you automate your VM provisioning process on VMware vSphere. Whether you’re a seasoned pro or just dipping your toes into automation, this guide will take you step by step through the process of using Terraform with vSphere to get your virtual machines (VMs) up and running in no time!</p>
<h2 id="-prerequisites">
  🔥 Prerequisites
  <a class="heading-link" href="#-prerequisites">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Before you dive in, make sure you have the following:</p>
<ul>
<li>🌍 A running vSphere environment with access to <strong>vCenter</strong>.</li>
<li>⚙️ <strong>Terraform</strong> installed on your machine (You can grab it <a href="https://www.terraform.io/downloads.html"  class="external-link" target="_blank" rel="noopener">here</a>).</li>
<li>🧑‍💻 The necessary <strong>permissions</strong> to create and manage VMs.</li>
<li>🖼️ An existing <strong>VM template</strong> or <strong>clone</strong> for deployment (I have prebuilt a golden image).</li>
</ul>
<p>(<a href="https://github.com/vmware-samples/packer-examples-for-vsphere/tree/develop/terraform/vsphere-role"  class="external-link" target="_blank" rel="noopener">https://github.com/vmware-samples/packer-examples-for-vsphere/tree/develop/terraform/vsphere-role</a>) Is a good place to start, this repo has the get starting templates to build templates with Packer. I have linked the folder which adds the correct roles to the user in vSphere as its quite lengthy doing it manually.</p>
<p>I had used this as a guide to give my Terraform vSphere user the least privilege roles.</p>
<h2 id="-step-1-build-the-terraform-image-from-a-clone">
  🛠️ Step 1: Build the Terraform Image from a Clone
  <a class="heading-link" href="#-step-1-build-the-terraform-image-from-a-clone">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Let’s kick things off by creating a VM from an existing clone in vSphere. Why a clone? It ensures consistency and speeds up deployment – plus, Terraform does all the hard work for you! 🙌</p>
<h3 id="11-terraform-configuration">
  1.1. Terraform Configuration
  <a class="heading-link" href="#11-terraform-configuration">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Create a file called <code>main.tf</code> with the following structure:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">provider</span> <span class="s2">&#34;vsphere&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  vsphere_server</span>       <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_server</span>
</span></span><span class="line"><span class="cl"><span class="n">  user</span>                 <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_username</span>
</span></span><span class="line"><span class="cl"><span class="n">  password</span>             <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_password</span>
</span></span><span class="line"><span class="cl"><span class="n">  allow_unverified_ssl</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_insecure</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="s2">&#34;vsphere_datacenter&#34; &#34;datacenter&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_datacenter</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="s2">&#34;vsphere_network&#34; &#34;network&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>          <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_network</span>
</span></span><span class="line"><span class="cl"><span class="n">  datacenter_id</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_datacenter</span><span class="p">.</span><span class="k">datacenter</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="s2">&#34;vsphere_compute_cluster&#34; &#34;cluster&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>          <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_cluster</span>
</span></span><span class="line"><span class="cl"><span class="n">  datacenter_id</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_datacenter</span><span class="p">.</span><span class="k">datacenter</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="s2">&#34;vsphere_resource_pool&#34; &#34;pool&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>          <span class="o">=</span> <span class="k">format</span><span class="p">(</span><span class="s2">&#34;%s%s&#34;, data.vsphere_compute_cluster.cluster.name, &#34;/Resources&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">  datacenter_id</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_datacenter</span><span class="p">.</span><span class="k">datacenter</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="s2">&#34;vsphere_datastore&#34; &#34;datastore&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>          <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_datastore</span>
</span></span><span class="line"><span class="cl"><span class="n">  datacenter_id</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_datacenter</span><span class="p">.</span><span class="k">datacenter</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="s2">&#34;vsphere_virtual_machine&#34; &#34;template&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>          <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_template</span>
</span></span><span class="line"><span class="cl"><span class="n">  datacenter_id</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_datacenter</span><span class="p">.</span><span class="k">datacenter</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;vsphere_virtual_machine&#34; &#34;vm&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                    <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vm_name</span>
</span></span><span class="line"><span class="cl"><span class="n">  folder</span>                  <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vsphere_folder</span>
</span></span><span class="line"><span class="cl"><span class="n">  num_cpus</span>                <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vm_cpus</span>
</span></span><span class="line"><span class="cl"><span class="n">  memory</span>                  <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vm_memory</span>
</span></span><span class="line"><span class="cl"><span class="n">  firmware</span>                <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vm_firmware</span>
</span></span><span class="line"><span class="cl"><span class="n">  efi_secure_boot_enabled</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">vm_efi_secure_boot_enabled</span>
</span></span><span class="line"><span class="cl"><span class="n">  guest_id</span>                <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_virtual_machine</span><span class="p">.</span><span class="k">template</span><span class="p">.</span><span class="k">guest_id</span>
</span></span><span class="line"><span class="cl"><span class="n">  datastore_id</span>            <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_datastore</span><span class="p">.</span><span class="k">datastore</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_pool_id</span>        <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_resource_pool</span><span class="p">.</span><span class="k">pool</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">  <span class="k">network_interface</span> {
</span></span><span class="line"><span class="cl"><span class="n">    network_id</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_network</span><span class="p">.</span><span class="k">network</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  <span class="k">disk</span> {
</span></span><span class="line"><span class="cl"><span class="n">    label</span>            <span class="o">=</span> <span class="s2">&#34;disk0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    size</span>             <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_virtual_machine</span><span class="p">.</span><span class="k">template</span><span class="p">.</span><span class="k">disks</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="k">size</span>
</span></span><span class="line"><span class="cl"><span class="n">    eagerly_scrub</span>    <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_virtual_machine</span><span class="p">.</span><span class="k">template</span><span class="p">.</span><span class="k">disks</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="k">eagerly_scrub</span>
</span></span><span class="line"><span class="cl"><span class="n">    thin_provisioned</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_virtual_machine</span><span class="p">.</span><span class="k">template</span><span class="p">.</span><span class="k">disks</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="k">thin_provisioned</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  <span class="k">clone</span> {
</span></span><span class="line"><span class="cl"><span class="n">    template_uuid</span> <span class="o">=</span> <span class="k">data</span><span class="p">.</span><span class="k">vsphere_virtual_machine</span><span class="p">.</span><span class="k">template</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  <span class="k">lifecycle</span> {
</span></span><span class="line"><span class="cl"><span class="n">    ignore_changes</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">clone</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="k">template_uuid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl"><span class="n">  extra_config</span> <span class="o">=</span> {
</span></span><span class="line"><span class="cl"><span class="n">    &#34;guestinfo.metadata&#34;</span>          <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="k">file</span><span class="p">(</span><span class="s2">&#34;${path.module}/metadata.yml&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">    &#34;guestinfo.metadata.encoding&#34;</span> <span class="o">=</span> <span class="s2">&#34;base64&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    &#34;guestinfo.userdata&#34;</span>          <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="k">file</span><span class="p">(</span><span class="s2">&#34;${path.module}/userdata.yml&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">    &#34;guestinfo.userdata.encoding&#34;</span> <span class="o">=</span> <span class="s2">&#34;base64&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>In this config, you&rsquo;re telling Terraform to create a VM based on a template and applying some basic customisations. 🎨</p>
<hr>
<h2 id="-step-12-add-the-variables">
  ⚡ Step 1.2: Add The Variables
  <a class="heading-link" href="#-step-12-add-the-variables">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Add a <code>variables.tfvars</code> file:</p>
<p>The Terraform configuration file for managing infrastructure with vSphere. It defines a set of variables that will be used to configure various aspects of a virtual machine (VM) and vSphere infrastructure.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##################################################################################</span>
</span></span><span class="line"><span class="cl"><span class="c1"># VARIABLES</span>
</span></span><span class="line"><span class="cl"><span class="c1">##################################################################################</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Credentials</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_server</span>   <span class="o">=</span> <span class="s2">&#34;vcenter_IP&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_username</span> <span class="o">=</span> <span class="s2">&#34;administrator@vsphere.local&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_password</span> <span class="o">=</span> <span class="s2">&#34;vcenter_password&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_insecure</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># vSphere Settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_datacenter</span> <span class="o">=</span> <span class="s2">&#34;Datacenter&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_cluster</span>    <span class="o">=</span> <span class="s2">&#34;cluster&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_datastore</span>  <span class="o">=</span> <span class="s2">&#34;cluster&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_folder</span>     <span class="o">=</span> <span class="s2">&#34;folder&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_network</span>    <span class="o">=</span> <span class="s2">&#34;network&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vsphere_template</span>   <span class="o">=</span> <span class="s2">&#34;Debian 12 Template&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Virtual Machines Settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">vm_name</span>                    <span class="o">=</span> <span class="s2">&#34;golden-image-staging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vm_cpus</span>                    <span class="o">=</span> <span class="m">8</span>
</span></span><span class="line"><span class="cl"><span class="nv">vm_memory</span>                  <span class="o">=</span> <span class="m">4096</span>
</span></span><span class="line"><span class="cl"><span class="nv">vm_firmware</span>                <span class="o">=</span> <span class="s2">&#34;efi&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">vm_efi_secure_boot_enabled</span> <span class="o">=</span> <span class="nb">true</span>
</span></span></code></pre></div><h2 id="-step-2-initialize-terraform">
  ⚡ Step 2: Initialize Terraform
  <a class="heading-link" href="#-step-2-initialize-terraform">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Before you get rolling, you’ll need to initialise your Terraform project.</p>
<p>Run this command to get things set up:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform init
</span></span></code></pre></div><p>This command does the following:</p>
<ul>
<li>Downloads the necessary <strong>providers</strong>.</li>
<li>Prepares the backend for storing <strong>state</strong>.</li>
<li>Validates your configuration files and ensures there are no glaring issues. ✅</li>
</ul>
<hr>
<h2 id="-step-3-plan-and-build-the-vm">
  🎯 Step 3: Plan and Build the VM
  <a class="heading-link" href="#-step-3-plan-and-build-the-vm">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Time to see the magic unfold! First, let&rsquo;s run a dry-run to check what Terraform will do:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform plan
</span></span></code></pre></div><p>If everything looks good, it’s showtime! Apply the changes and let Terraform work its charm:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform apply
</span></span></code></pre></div><p>You’ll be prompted to confirm. Type <strong><code>yes</code></strong> and hit Enter. 🎉</p>
<p>After the magic happens, your new VM will be ready to go in vSphere! 🚀</p>
<hr>
<h2 id="-creating-a-new-vm-without-editing-an-existing-one">
  ✨ Creating a New VM Without Editing an Existing One
  <a class="heading-link" href="#-creating-a-new-vm-without-editing-an-existing-one">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>I only note this part since I had a slight hiccup as I had edited/replaced the VM I had just built!</p>
<p>By default, Terraform keeps track of all your resources in a file called <code>terraform.tfstate</code>. If you reapply, it will modify existing resources, which can be a little&hellip; risky! 😬</p>
<h3 id="41-use-a-different-terraform-state-file">
  4.1. Use a Different Terraform State File
  <a class="heading-link" href="#41-use-a-different-terraform-state-file">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>To avoid modifying your current VM, you can use a fresh state file by running this command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform apply -state<span class="o">=</span>new_vm.tfstate
</span></span></code></pre></div><p>This tells Terraform to treat the new VM as a <strong>new and independent resource</strong>, giving you peace of mind. 😌</p>
<hr>
<h2 id="-conclusion">
  🏁 Conclusion
  <a class="heading-link" href="#-conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Boom! You&rsquo;re now a Terraform wizard in vSphere. 🧙‍♂️ By using Terraform’s powerful state management and automation, you can streamline your VM creation process, ensuring consistency and minimising human error. No more manual VM juggling—let Terraform handle the heavy lifting!</p>
<hr>
<h2 id="afterthoughts">
  Afterthoughts
  <a class="heading-link" href="#afterthoughts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>I want to secure the variables file either by using .env file, setting environment variables on the host or using Hashicorp vault.</p>
<p>At the present time as I am rebuilding my SOC SIEM Lab I hope to come back and add further security enhancements.!</p>
<pre tabindex="0"><code></code></pre>
      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2021 -
    
    2025
     JAM_SEC 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/jam_sec/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
